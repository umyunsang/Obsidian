
---
## 4. 뷰
#### 뷰(view)
- 다른 테이블을 기반으로 만들어진 **가상 테이블** 
	- 데이터를 실제로 저장하지 않고 **논리적으로만 존재하는 테이블** 
- 일반 테이블과 동일한 방법으로 사용 
- 뷰를 통해 기본 테이블의 내용을 **쉽게 검색**할 수는 있지만, 기본 테이블의 **내용을 바꾸는 작업은 제한적으로 이루어짐** 
	- **기본 테이블**: 뷰를 만드는데 기반이 되는 **물리적인 테이블** 
- 다른 뷰를 기반으로 새로운 뷰를 만드는 것도 가능
- 뷰는 **기본 테이블을 들여다 볼 수 있는 창 역할**을 담당 (뷰의 목적)

#### 뷰 생성 : CREATE VIEW 문
```sql
CREATE VIEW 뷰_이름[(속성_리스트)]
AS SELECT 문
[WITH CHECK OPTION];
```
- CREATE VIEW 키워드와 함께 생성할 뷰의 이름과 속성의 이름을 나열 
	- **속성 리스트를 생략하면 SELECT 절에 나열된 속성의 이름을 그대로 사용** 
- AS 키워드와 함께 기본 테이블에 대한 SELECT 문 제시 
	- SELECT 문은 생성하려는 뷰의 정의를 표현하며 **ORDER BY는 사용 불가** 
		- 오라클과 같은 일부 DBMS에서는 ORDER BY를 허용하기도 함 
- WITH CHECK OPTION 
	- 뷰에 삽입이나 수정 연산을 할 때 **SELECT 문에서 제시한 뷰의 정의 조건을 위반하면 수행되지 않도록 하는 제약조건을 지정**

![[Pasted image 20241028163957.png]]
```SQL
CREATE VIEW 우수고객(고객아이디, 고객이름, 나이, 등급)
AS SELECT 고객아이디, 고객이름, 나이, 등급
	FROM 고객
	WHERE 등급='VIP'
WITH CHECK OPTION;

/* 생략 가능 */
CREATE VIEW 우수고객
AS SELECT 고객아이디, 고객이름, 나이, 등급
	FROM 고객
	WHERE 등급='VIP'
WITH CHECK OPTION;
```
- 뷰가 생성된 후에 우수고객 뷰에 ‘vip’ 등급이 아닌 고객 데이터를 삽입하거나 뷰의 정의 조건을 위반하는 수정 및 삭제 연산을 시도하면 실행을 거부함 (WITH CHECK OPTION 때문)

![[Pasted image 20241028164210.png]]
```SQL
CREATE VIEW 업체별제품수(제조업체, 제품수)
AS SELECT 제조업체, COUNT(*)
	FROM 제품
	GROUP BY 제조업체
WITH CHECK OPTION;
```
- **제품수 속성**은 기본 테이블인 제품 테이블에 원래 있던 속성이 아니라 집계 함수를 통해 **새로 계산된 것**이므로 **속성의 이름을 명확히 제시해야 함**

#### 뷰 활용 : SELECT 문
- 일반 테이블과 같은 방법으로 원하는 데이터를 검색할 수 있음 
	- 뷰에 대한 SELECT 문이 내부적으로는 기본 테이블에 대한 SELECT 문으로 변환되어 수행
- **검색 연산은 모든 뷰에 수행 가능**

![[Pasted image 20241028164652.png]]
```SQL
SELECT * FROM 우수고객 WHERE 나이>=20;
```

#### 뷰 활용 : INSERT, UPDATE, DELETE 문
- 뷰에 대한 삽입, 수정, 삭제 연산 가능 
	- 실제로 기본 테이블에 수행되므로 결과적으로는 기본 테이블이 변경됨
- 뷰에 대한 삽입, 수정, 삭제 연산은 제한적으로 수행됨 
	- 변경 가능한 뷰 vs. 변경 불가능한 뷰
- ==**변경 불가능한 뷰의 특징**==
	- 기본 테이블의 **기본키를 구성하는 속성이 포함되어 있지 않은 뷰** 
		- 개체 무결성의 이유
	- 기본 테이블에서 **NOT NULL로 지정된 속성이 포함되어 있지 않은 뷰** 
	- 기본 테이블에 있던 내용이 아닌 집계 함수로 **새로 계산된 내용을 포함하는 뷰**
	- **DISTINCT** 키워드를 포함하여 정의한 뷰 
	- **GROUP BY 절**을 포함하여 정의한 뷰 
	- 여러 개의 테이블을 **조인하여 정의한 뷰**는 변경이 불가능한 경우가 많음

#### ==뷰의 장점==
- 질의문을 좀 더 **쉽게 작성**할 수 있다
	- GROUP BY, 집계 함수, 조인 등을 이용해 미리 뷰를 만들어 놓으면, 복잡한 SQL 문 대신 SELECT 절과 **FROM 절만으로 원하는 데이터 검색이 가능** 
- 데이터의 **보안 유지**에 도움이 된다
	- 자신에게 제공된 뷰를 통해서만 데이터에 접근하도록 **권한 설정이 가능** 
- 데이터를 좀 더 편리하게 관리할 수 있다
	- 제공된 뷰와 관련이 없는 다른 내용에 대해 사용자가 신경 쓸 필요가 없음

#### 뷰 삭제 : DROP VIEW 문
```SQL
DROP VIEW 뷰_이름;
```
- 뷰를 삭제해도 기본 테이블은 영향을 받지 않음
- 만약, 삭제할 뷰를 참조하는 **제약조건**이 존재한다면? 
	- 뷰 삭제가 수행되지 않음 
	- **관련된 제약조건을 먼저 삭제해야 함** 
	- 예) 삭제할 뷰를 이용해 만들어진 다른 뷰가 존재하는 경우

## 5. 삽입 SQL
- 삽입 SQL(ESQL; Embedded SQL) 
	- 프로그래밍 언어로 작성된 응용 프로그램 안에 삽입하여 사용하는 SQL 문 
- 주요 특징 
	- 프로그램 안에서 일반 명령문이 위치할 수 있는 곳이면 어디든 삽입 가능 
	- 일반 명령문과 구별하기 위해 삽입 SQL 문 앞에 EXEC SQL을 붙임 
	- 프로그램에 선언된 일반 변수를 **삽입 SQL 문에서 사용할 때는 이름 앞에 콜론(:)을** 붙여서 구분함 
- 커서(cursor) 
	- 수행 결과로 반환된 여러 행을 한 번에 하나씩 가리키는 **포인터** 
	- 여러 개의 행을 결과로 반환하는 SELECT 문을 프로그램에서 사용할 때 필요
- 삽입 SQL 문에서 사용할 변수 선언 방법 
	- BEGIN DECLARE SECTION과 END DECLARE SECTION 사이에 선언 
- 커서가 필요 없는 삽입 SQL 
	- CREATE TABLE 문, INSERT 문, DELETE 문, UPDATE 문 
	- 결과로 행 하나만 반환하는 SELECT 문

```C
int main() {
	EXEC SQL BEGIN DECLARE SECTION;
		char p_no[4], p_name[21];
		int price;
	EXEC SQL END DECLARE SECTION;
	
	printf('제품번호를 입력하세요 : ');
	scanf('%s', p_no);
	
	EXEC SQL SELECT 제품명, 단가 INTO :p_name, :price
		FROM 제품
		WHERE 제품번호 = :p_no;
		
	printf('\n 제품명 = %s', p_name);
	printf('\n 단가 = %d', price);
	
	return 0;
}
```
