
---
데드락 회피는 기말문제 무조건 나옴

## 3-3 교착 상태 회피
#### 교착 상태 회피의 개념
- 프로세스에 자원을 할당할 때 어느 수준 이상의 자원을 나누어주면 교착 상태가 발생하는지 파악하여 그 수준 이하로 자원을 나누어주는 방법 
- 교착 상태가 발생하지 않는 범위 내에서만 자원을 할당하고, 교착 상태가 발생하는 범위에 있으면 프로세스를 대기시킴 
- 즉, 할당되는 자원의 수를 조절하여 교착 상태를 피함

#### 안정 상태와 불안정 상태
- 교착 상태 회피는 자원의 총수와 현재 할당된 자원의 수를 기준으로 시스템을 안정 상태와 불안정 상태로 나누고 시스템이 안정 상태를 유지하도록 자원을 할당 
- 할당된 자원이 적으면 안정 상태가 크고, 할당된 자원이 늘어날수록 불안정 상태가 커짐 
- 교착 상태는 불안정 상태의 일부분 이며, 불안정 상태가 커질수록 교착 상태가 발생할 가능성이 높아짐 
- 교착 상태 회피는 안정 상태를 유지할 수 있는 범위 내에서 자원을 할당함으로써 교착 상태를 피함

#### 은행원 알고리즘
- 교착 상태 회피를 구현하는 대표적인 알고리즘 
- 은행이 대출을 해주는 방식, 즉 대출 금액이 대출 가능한 범위 내이 면(안정 상태이면) 허용되지만 그렇지 않으면 거부되는 것과 유사한 방식

![[Pasted image 20241111090811.png]]

#### 은행원 알고리즘에서 자원 할당 기준
- 요청한 자원을 할당해 준 뒤에도 시스템이 안정상태에 있다면 그 요청을 수락한다
- 안정상태: 시스템이 안정순서(safe sequence)를 가질 때 안정상태에 있다고 말함 
- Safe sequence: 각 프로세스의 Need를 어떤 순서대로 만족시켜 줄 수 있을 때, 그 순서를 safe sequence 라 부른다.

![[Pasted image 20241111091225.png]]
- Need = Max - Alloc
- p0는 wait
- p1의 요청은 들어줌 -> p1이 종료를 하면 -> p1이 가지고 있는 max 자원을 반환함
- 332(available) - 122(need) + 322(max) = 532(available)
- p1p3p0p2p4 순으로 처리 됨

#### Resource-Allocation Graph Algorithm
![[Pasted image 20241111093135.png]]
- p1의 요청을 들어주면 사이클이 안생겨서 데드락이 안생기지만
- p2의 요청을 들어주면 사이클이 생겨서 데드락이 생길 수 있음

#### 교착 상태 회피의 문제점
- 프로세스가 자신이 사용할 모든 자원을 미리 선언해야 함 
- 시스템의 전체 자원 수가 **고정적이어야 함** 
- 자원이 낭비됨 
- 알고리즘 적용에 따른 오버헤드가 큼

#### 교착상태 감지 및 복구
- 교착상태를 감지하는 프로그램을 통해, 형성된 교착상태를 푼다
	- 백그라운드에서 교착상태를 감지하는 프로그램 늘 실행 
	
- 교착상태를 감지하였을 때의 복구 방법 
	- **자원 강제 선점(preemption)** 
		- 교착상태에 빠진 스레드 중 하나의 자원을 강제로 빼앗아 다른 스레드에게 할당
		
	- **롤백(rollback)** 
		- 운영체제는 주기적으로 교착상태가 발생할 것으로 예측되는 스레드의 상태를 저장하여 두고 교착상태가 발생하면 마지막으로 저장된 상태로 돌아가도록 하고, 다시 시작하면서 자원을 다르게 할당 
		
	- **스레드 강제 종료(kill process)** 
		- 교착상태에 빠진 스레드 중 하나 강제 종료 
		- 가장 간단하면서도 효과적인 방법 
		
	- 시간과 메모리 공간(rollback의 경우)에 대한 부담이 크기 때문에 잘 사용하지 않음

#### 교착상태 무시 : 타조(Ostrich) 알고리즘
- 타조 알고리즘
	- Unix와 윈도우 등 현재 거의 모든 운영체제에서 사용 
		- 의심 가는 스레드를 종료시키거나 시스템 재시작(reboot) 
		- 거의 발생하지 않거나 아주 드물게 발생하는 것에 비해 교착상태 해결에는 상대적으로 비용이 많이 들기 때문
		
	- 핵 시스템, 비행기, 미사일 등 시스템 재시작이 파국을 초래할 hard real- time 시스템이나 환자 감시 시스템 등에서는 적합하지 않음 
		- 이런 시스템에서는 자원에 대한 프로세스의 할당 등에 대해 미리 알고 적절한 조치가 필요
